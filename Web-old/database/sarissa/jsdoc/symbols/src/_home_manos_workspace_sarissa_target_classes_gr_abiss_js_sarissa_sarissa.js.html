<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"> <style>
	.KEYW {color: #933;}
	.COMM {color: #bbb; font-style: italic;}
	.NUMB {color: #393;}
	.STRN {color: #393;}
	.REGX {color: #339;}
	.line {border-right: 1px dotted #666; color: #666; font-style: normal;}
	</style></head><body><pre><span class='line'>  1</span> <span class="COMM">/*
<span class='line'>  2</span>  * ====================================================================
<span class='line'>  3</span>  * About Sarissa: http://dev.abiss.gr/sarissa
<span class='line'>  4</span>  * ====================================================================
<span class='line'>  5</span>  * Sarissa is an ECMAScript library acting as a cross-browser wrapper for native XML APIs.
<span class='line'>  6</span>  * The library supports Gecko based browsers like Mozilla and Firefox,
<span class='line'>  7</span>  * Internet Explorer (5.5+ with MSXML3.0+), Konqueror, Safari and Opera
<span class='line'>  8</span>  * @version 0.9.9.5
<span class='line'>  9</span>  * @author: Copyright 2004-2008 Emmanouil Batsis, mailto: mbatsis at users full stop sourceforge full stop net
<span class='line'> 10</span>  * ====================================================================
<span class='line'> 11</span>  * Licence
<span class='line'> 12</span>  * ====================================================================
<span class='line'> 13</span>  * Sarissa is free software distributed under the GNU GPL version 2 (see &lt;a href="gpl.txt">gpl.txt&lt;/a>) or higher, 
<span class='line'> 14</span>  * GNU LGPL version 2.1 (see &lt;a href="lgpl.txt">lgpl.txt&lt;/a>) or higher and Apache Software License 2.0 or higher 
<span class='line'> 15</span>  * (see &lt;a href="asl.txt">asl.txt&lt;/a>). This means you can choose one of the three and use that if you like. If 
<span class='line'> 16</span>  * you make modifications under the ASL, i would appreciate it if you submitted those.
<span class='line'> 17</span>  * In case your copy of Sarissa does not include the license texts, you may find
<span class='line'> 18</span>  * them online in various formats at &lt;a href="http://www.gnu.org">http://www.gnu.org&lt;/a> and 
<span class='line'> 19</span>  * &lt;a href="http://www.apache.org">http://www.apache.org&lt;/a>.
<span class='line'> 20</span>  *
<span class='line'> 21</span>  * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY 
<span class='line'> 22</span>  * KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE 
<span class='line'> 23</span>  * WARRANTIES OF MERCHANTABILITY,FITNESS FOR A PARTICULAR PURPOSE 
<span class='line'> 24</span>  * AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR 
<span class='line'> 25</span>  * COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
<span class='line'> 26</span>  * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR 
<span class='line'> 27</span>  * OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE 
<span class='line'> 28</span>  * SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
<span class='line'> 29</span>  */</span><span class="WHIT">
<span class='line'> 30</span> </span><span class="COMM">/**
<span class='line'> 31</span>  * &lt;p>Sarissa is a utility class. Provides "static" methods for DOMDocument, 
<span class='line'> 32</span>  * DOM Node serialization to XML strings and other utility goodies.&lt;/p>
<span class='line'> 33</span>  * @constructor
<span class='line'> 34</span>  * @static
<span class='line'> 35</span>  */</span><span class="WHIT">
<span class='line'> 36</span> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">Sarissa</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 37</span> </span><span class="NAME">Sarissa.VERSION</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"0.9.9.5"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 38</span> </span><span class="NAME">Sarissa.PARSED_OK</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"Document contains no parsing errors"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 39</span> </span><span class="NAME">Sarissa.PARSED_EMPTY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"Document is empty"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 40</span> </span><span class="NAME">Sarissa.PARSED_UNKNOWN_ERROR</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"Not well-formed or other error"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 41</span> </span><span class="NAME">Sarissa.IS_ENABLED_TRANSFORM_NODE</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 42</span> </span><span class="NAME">Sarissa.REMOTE_CALL_FLAG</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"gr.abiss.sarissa.REMOTE_CALL_FLAG"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 43</span> </span><span class="COMM">/** @private */</span><span class="WHIT">
<span class='line'> 44</span> </span><span class="NAME">Sarissa._lastUniqueSuffix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 45</span> </span><span class="COMM">/** @private */</span><span class="WHIT">
<span class='line'> 46</span> </span><span class="NAME">Sarissa._getUniqueSuffix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 47</span> 	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Sarissa._lastUniqueSuffix</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 48</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 49</span> </span><span class="COMM">/** @private */</span><span class="WHIT">
<span class='line'> 50</span> </span><span class="NAME">Sarissa._SARISSA_IEPREFIX4XSLPARAM</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 51</span> </span><span class="COMM">/** @private */</span><span class="WHIT">
<span class='line'> 52</span> </span><span class="NAME">Sarissa._SARISSA_HAS_DOM_IMPLEMENTATION</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.implementation</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 53</span> </span><span class="COMM">/** @private */</span><span class="WHIT">
<span class='line'> 54</span> </span><span class="NAME">Sarissa._SARISSA_HAS_DOM_CREATE_DOCUMENT</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Sarissa._SARISSA_HAS_DOM_IMPLEMENTATION</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">document.implementation.createDocument</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 55</span> </span><span class="COMM">/** @private */</span><span class="WHIT">
<span class='line'> 56</span> </span><span class="NAME">Sarissa._SARISSA_HAS_DOM_FEATURE</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Sarissa._SARISSA_HAS_DOM_IMPLEMENTATION</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">document.implementation.hasFeature</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 57</span> </span><span class="COMM">/** @private */</span><span class="WHIT">
<span class='line'> 58</span> </span><span class="NAME">Sarissa._SARISSA_IS_MOZ</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Sarissa._SARISSA_HAS_DOM_CREATE_DOCUMENT</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">Sarissa._SARISSA_HAS_DOM_FEATURE</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 59</span> </span><span class="COMM">/** @private */</span><span class="WHIT">
<span class='line'> 60</span> </span><span class="NAME">Sarissa._SARISSA_IS_SAFARI</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">navigator.userAgent.toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">indexOf</span><span class="PUNC">(</span><span class="STRN">"safari"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">navigator.userAgent.toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">indexOf</span><span class="PUNC">(</span><span class="STRN">"konqueror"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 61</span> </span><span class="COMM">/** @private */</span><span class="WHIT">
<span class='line'> 62</span> </span><span class="NAME">Sarissa._SARISSA_IS_SAFARI_OLD</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Sarissa._SARISSA_IS_SAFARI</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">navigator.userAgent.match</span><span class="PUNC">(</span><span class="REGX">/AppleWebKit\/(\d+)/</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">420</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 63</span> </span><span class="COMM">/** @private */</span><span class="WHIT">
<span class='line'> 64</span> </span><span class="NAME">Sarissa._SARISSA_IS_IE</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.all</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">window.ActiveXObject</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">navigator.userAgent.toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">indexOf</span><span class="PUNC">(</span><span class="STRN">"msie"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT">  </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">navigator.userAgent.toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">indexOf</span><span class="PUNC">(</span><span class="STRN">"opera"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 65</span> </span><span class="COMM">/** @private */</span><span class="WHIT">
<span class='line'> 66</span> </span><span class="NAME">Sarissa._SARISSA_IS_OPERA</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">navigator.userAgent.toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">indexOf</span><span class="PUNC">(</span><span class="STRN">"opera"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 67</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">window.Node</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">Node.ELEMENT_NODE</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 68</span>     </span><span class="NAME">Node</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">ELEMENT_NODE</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ATTRIBUTE_NODE</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">TEXT_NODE</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">CDATA_SECTION_NODE</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ENTITY_REFERENCE_NODE</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">5</span><span class="PUNC">,</span><span class="WHIT">  </span><span class="NAME">ENTITY_NODE</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">6</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">PROCESSING_INSTRUCTION_NODE</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">7</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">COMMENT_NODE</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">8</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">DOCUMENT_NODE</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">9</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">DOCUMENT_TYPE_NODE</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">DOCUMENT_FRAGMENT_NODE</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">11</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">NOTATION_NODE</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">12</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 69</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 70</span> 
<span class='line'> 71</span> </span><span class="COMM">//This breaks for(x in o) loops in the old Safari</span><span class="WHIT">
<span class='line'> 72</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">Sarissa._SARISSA_IS_SAFARI_OLD</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 73</span> 	</span><span class="NAME">HTMLHtmlElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">"html"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">constructor</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 74</span> 	</span><span class="NAME">Node</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">HTMLElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 75</span> 	</span><span class="NAME">HTMLElement.prototype</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">HTMLHtmlElement.__proto__.__proto__</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 76</span> 	</span><span class="NAME">HTMLDocument</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Document</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.constructor</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 77</span> 	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">DOMParser</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 78</span> 	</span><span class="NAME">XMLDocument</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">x.constructor</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 79</span> 	</span><span class="NAME">Element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">x.parseFromString</span><span class="PUNC">(</span><span class="STRN">"&lt;Single />"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"text/xml"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">documentElement.constructor</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 80</span> 	</span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 81</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 82</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">XMLDocument</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"undefined"</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">Document</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">XMLDocument</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Document</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT"> 
<span class='line'> 83</span> 
<span class='line'> 84</span> </span><span class="COMM">// IE initialization</span><span class="WHIT">
<span class='line'> 85</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">Sarissa._SARISSA_IS_IE</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 86</span>     </span><span class="COMM">// for XSLT parameter names, prefix needed by IE</span><span class="WHIT">
<span class='line'> 87</span>     </span><span class="NAME">Sarissa._SARISSA_IEPREFIX4XSLPARAM</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"xsl:"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 88</span>     </span><span class="COMM">// used to store the most recent ProgID available out of the above</span><span class="WHIT">
<span class='line'> 89</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_SARISSA_DOM_PROGID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 90</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_SARISSA_XMLHTTP_PROGID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 91</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_SARISSA_DOM_XMLWRITER</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 92</span>     </span><span class="COMM">/**
<span class='line'> 93</span>      * Called when the sarissa.js file is parsed, to pick most recent
<span class='line'> 94</span>      * ProgIDs for IE, then gets destroyed.
<span class='line'> 95</span>      * @memberOf Sarissa
<span class='line'> 96</span>      * @private
<span class='line'> 97</span>      * @param idList an array of MSXML PROGIDs from which the most recent will be picked for a given object
<span class='line'> 98</span>      * @param enabledList an array of arrays where each array has two items; the index of the PROGID for which a certain feature is enabled
<span class='line'> 99</span>      */</span><span class="WHIT">
<span class='line'>100</span>     </span><span class="NAME">Sarissa.pickRecentProgID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">idList</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>101</span>         </span><span class="COMM">// found progID flag</span><span class="WHIT">
<span class='line'>102</span>         </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bFound</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>103</span>         </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">o2Store</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>104</span>         </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">idList.length</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">bFound</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>105</span>             </span><span class="KEYW">try</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>106</span>                 </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">oDoc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">ActiveXObject</span><span class="PUNC">(</span><span class="NAME">idList</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>107</span>                 </span><span class="NAME">o2Store</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">idList</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>108</span>                 </span><span class="NAME">bFound</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>109</span>             </span><span class="PUNC">}</span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">objException</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>110</span>                 </span><span class="COMM">// trap; try next progID</span><span class="WHIT">
<span class='line'>111</span>                 </span><span class="NAME">e</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">objException</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>112</span>             </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>113</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>114</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">bFound</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>115</span>             </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="STRN">"Could not retrieve a valid progID of Class: "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">idList</span><span class="PUNC">[</span><span class="NAME">idList.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">". (original exception: "</span><span class="PUNC">+</span><span class="NAME">e</span><span class="PUNC">+</span><span class="STRN">")"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>116</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>117</span>         </span><span class="NAME">idList</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>118</span>         </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">o2Store</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>119</span>     </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>120</span>     </span><span class="COMM">// pick best available MSXML progIDs</span><span class="WHIT">
<span class='line'>121</span>     </span><span class="NAME">_SARISSA_DOM_PROGID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>122</span>     </span><span class="NAME">_SARISSA_THREADEDDOM_PROGID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>123</span>     </span><span class="NAME">_SARISSA_XSLTEMPLATE_PROGID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>124</span>     </span><span class="NAME">_SARISSA_XMLHTTP_PROGID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>125</span>     </span><span class="COMM">// commenting the condition out; we need to redefine XMLHttpRequest </span><span class="WHIT">
<span class='line'>126</span>     </span><span class="COMM">// anyway as IE7 hardcodes it to MSXML3.0 causing version problems </span><span class="WHIT">
<span class='line'>127</span>     </span><span class="COMM">// between different activex controls </span><span class="WHIT">
<span class='line'>128</span>     </span><span class="COMM">//if(!window.XMLHttpRequest){</span><span class="WHIT">
<span class='line'>129</span>     </span><span class="COMM">/**
<span class='line'>130</span>      * Emulate XMLHttpRequest
<span class='line'>131</span>      * @constructor
<span class='line'>132</span>      */</span><span class="WHIT">
<span class='line'>133</span>     </span><span class="NAME">XMLHttpRequest</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>134</span>         </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">_SARISSA_XMLHTTP_PROGID</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>135</span>             </span><span class="NAME">_SARISSA_XMLHTTP_PROGID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Sarissa.pickRecentProgID</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="STRN">"Msxml2.XMLHTTP.6.0"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"MSXML2.XMLHTTP.3.0"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"MSXML2.XMLHTTP"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"Microsoft.XMLHTTP"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>136</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>137</span>         </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">ActiveXObject</span><span class="PUNC">(</span><span class="NAME">_SARISSA_XMLHTTP_PROGID</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>138</span>     </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>139</span>     </span><span class="COMM">//}</span><span class="WHIT">
<span class='line'>140</span>     </span><span class="COMM">// we dont need this anymore</span><span class="WHIT">
<span class='line'>141</span>     </span><span class="COMM">//============================================</span><span class="WHIT">
<span class='line'>142</span>     </span><span class="COMM">// Factory methods (IE)</span><span class="WHIT">
<span class='line'>143</span>     </span><span class="COMM">//============================================</span><span class="WHIT">
<span class='line'>144</span>     </span><span class="COMM">// see non-IE version</span><span class="WHIT">
<span class='line'>145</span>     </span><span class="NAME">Sarissa.getDomDocument</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">sUri</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sName</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>146</span>         </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">_SARISSA_DOM_PROGID</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>147</span>         	</span><span class="KEYW">try</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>148</span>         		</span><span class="NAME">_SARISSA_DOM_PROGID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Sarissa.pickRecentProgID</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="STRN">"Msxml2.DOMDocument.6.0"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"Msxml2.DOMDocument.3.0"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"MSXML2.DOMDocument"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"MSXML.DOMDocument"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"Microsoft.XMLDOM"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>149</span>         	</span><span class="PUNC">}</span><span class="KEYW">catch</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>150</span>         		</span><span class="NAME">_SARISSA_DOM_PROGID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"noActiveX"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>151</span>         	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>152</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>153</span> 
<span class='line'>154</span>         </span><span class="COMM">// Not sure how far IE can carry this but try to do something useful when ActiveX is disabled</span><span class="WHIT">
<span class='line'>155</span>         </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">oDoc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_SARISSA_DOM_PROGID</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"noActiveX"</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">"xml"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">ActiveXObject</span><span class="PUNC">(</span><span class="NAME">_SARISSA_DOM_PROGID</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>156</span>         </span><span class="COMM">// set validation off, make sure older IEs dont choke (no time or IEs to test ;-)</span><span class="WHIT">
<span class='line'>157</span>         </span><span class="KEYW">try</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>158</span>         	</span><span class="NAME">oDoc.validateOnParse</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>159</span>         	</span><span class="NAME">oDoc.resolveExternals</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"false"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>160</span>         	</span><span class="NAME">oDoc.setProperty</span><span class="PUNC">(</span><span class="STRN">"ProhibitDTD"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>161</span>         </span><span class="PUNC">}</span><span class="KEYW">catch</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>162</span>         
<span class='line'>163</span>         </span><span class="COMM">// if a root tag name was provided, we need to load it in the DOM object</span><span class="WHIT">
<span class='line'>164</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sName</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>165</span>             </span><span class="COMM">// create an artifical namespace prefix </span><span class="WHIT">
<span class='line'>166</span>             </span><span class="COMM">// or reuse existing prefix if applicable</span><span class="WHIT">
<span class='line'>167</span>             </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">prefix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>168</span>             </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">sUri</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>169</span>                 </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">sName.indexOf</span><span class="PUNC">(</span><span class="STRN">":"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>170</span>                     </span><span class="NAME">prefix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sName.substring</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sName.indexOf</span><span class="PUNC">(</span><span class="STRN">":"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>171</span>                     </span><span class="NAME">sName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sName.substring</span><span class="PUNC">(</span><span class="NAME">sName.indexOf</span><span class="PUNC">(</span><span class="STRN">":"</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>172</span>                 </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>173</span>                     </span><span class="NAME">prefix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"a"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">Sarissa._getUniqueSuffix</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>174</span>                 </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>175</span>             </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>176</span>             </span><span class="COMM">// use namespaces if a namespace URI exists</span><span class="WHIT">
<span class='line'>177</span>             </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">sUri</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>178</span>                 </span><span class="NAME">oDoc.loadXML</span><span class="PUNC">(</span><span class="STRN">'&lt;'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">prefix</span><span class="PUNC">+</span><span class="STRN">':'</span><span class="PUNC">+</span><span class="NAME">sName</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" xmlns:"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">prefix</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"=\""</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">sUri</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"\""</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" />"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>179</span>             </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>180</span>                 </span><span class="NAME">oDoc.loadXML</span><span class="PUNC">(</span><span class="STRN">'&lt;'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">sName</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" />"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>181</span>             </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>182</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>183</span>         </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">oDoc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>184</span>     </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>185</span>     </span><span class="COMM">// see non-IE version   </span><span class="WHIT">
<span class='line'>186</span>     </span><span class="NAME">Sarissa.getParseErrorText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">oDoc</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>187</span>         </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">parseErrorText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Sarissa.PARSED_OK</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>188</span>         </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">oDoc</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">oDoc.parseError</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">oDoc.parseError.errorCode</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">oDoc.parseError.errorCode</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>189</span>             </span><span class="NAME">parseErrorText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"XML Parsing Error: "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">oDoc.parseError.reason</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> 
<span class='line'>190</span>                 </span><span class="STRN">"\nLocation: "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">oDoc.parseError.url</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> 
<span class='line'>191</span>                 </span><span class="STRN">"\nLine Number "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">oDoc.parseError.line</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">", Column "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> 
<span class='line'>192</span>                 </span><span class="NAME">oDoc.parseError.linepos</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> 
<span class='line'>193</span>                 </span><span class="STRN">":\n"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">oDoc.parseError.srcText</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>194</span>                 </span><span class="STRN">"\n"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>195</span>             </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">  </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">oDoc.parseError.linepos</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>196</span>                 </span><span class="NAME">parseErrorText</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"-"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>197</span>             </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>198</span>             </span><span class="NAME">parseErrorText</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT">  </span><span class="STRN">"^\n"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>199</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>200</span>         </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">oDoc.documentElement</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>201</span>             </span><span class="NAME">parseErrorText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Sarissa.PARSED_EMPTY</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>202</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>203</span>         </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">parseErrorText</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>204</span>     </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>205</span>     </span><span class="COMM">// see non-IE version</span><span class="WHIT">
<span class='line'>206</span>     </span><span class="NAME">Sarissa.setXpathNamespaces</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">oDoc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sNsSet</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>207</span>         </span><span class="NAME">oDoc.setProperty</span><span class="PUNC">(</span><span class="STRN">"SelectionLanguage"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"XPath"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>208</span>         </span><span class="NAME">oDoc.setProperty</span><span class="PUNC">(</span><span class="STRN">"SelectionNamespaces"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sNsSet</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>209</span>     </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>210</span>     </span><span class="COMM">/**
<span class='line'>211</span>      * A class that reuses the same XSLT stylesheet for multiple transforms.
<span class='line'>212</span>      * @constructor
<span class='line'>213</span>      */</span><span class="WHIT">
<span class='line'>214</span>     </span><span class="NAME">XSLTProcessor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>215</span>         </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">_SARISSA_XSLTEMPLATE_PROGID</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>216</span>             </span><span class="NAME">_SARISSA_XSLTEMPLATE_PROGID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Sarissa.pickRecentProgID</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="STRN">"Msxml2.XSLTemplate.6.0"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"MSXML2.XSLTemplate.3.0"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>217</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>218</span>         </span><span class="NAME">this.template</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">ActiveXObject</span><span class="PUNC">(</span><span class="NAME">_SARISSA_XSLTEMPLATE_PROGID</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>219</span>         </span><span class="NAME">this.processor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>220</span>     </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>221</span>     </span><span class="COMM">/**
<span class='line'>222</span>      * Imports the given XSLT DOM and compiles it to a reusable transform
<span class='line'>223</span>      * &lt;b>Note:&lt;/b> If the stylesheet was loaded from a URL and contains xsl:import or xsl:include elements,it will be reloaded to resolve those
<span class='line'>224</span>      * @param {DOMDocument} xslDoc The XSLT DOMDocument to import
<span class='line'>225</span>      */</span><span class="WHIT">
<span class='line'>226</span>     </span><span class="NAME">XSLTProcessor.prototype.importStylesheet</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">xslDoc</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>227</span>         </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">_SARISSA_THREADEDDOM_PROGID</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>228</span>             </span><span class="NAME">_SARISSA_THREADEDDOM_PROGID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Sarissa.pickRecentProgID</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="STRN">"MSXML2.FreeThreadedDOMDocument.6.0"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"MSXML2.FreeThreadedDOMDocument.3.0"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>229</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>230</span>         </span><span class="NAME">xslDoc.setProperty</span><span class="PUNC">(</span><span class="STRN">"SelectionLanguage"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"XPath"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>231</span>         </span><span class="NAME">xslDoc.setProperty</span><span class="PUNC">(</span><span class="STRN">"SelectionNamespaces"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"xmlns:xsl='http://www.w3.org/1999/XSL/Transform'"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>232</span>         </span><span class="COMM">// convert stylesheet to free threaded</span><span class="WHIT">
<span class='line'>233</span>         </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">converted</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">ActiveXObject</span><span class="PUNC">(</span><span class="NAME">_SARISSA_THREADEDDOM_PROGID</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>234</span>         </span><span class="COMM">// make included/imported stylesheets work if exist and xsl was originally loaded from url</span><span class="WHIT">
<span class='line'>235</span>         </span><span class="KEYW">try</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>236</span>             </span><span class="NAME">converted.resolveExternals</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>237</span>             </span><span class="NAME">converted.setProperty</span><span class="PUNC">(</span><span class="STRN">"AllowDocumentFunction"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>238</span>             </span><span class="NAME">converted.setProperty</span><span class="PUNC">(</span><span class="STRN">"AllowXsltScript"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>239</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>240</span>         </span><span class="KEYW">catch</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>241</span>             </span><span class="COMM">// Ignore. "AllowDocumentFunction" and "AllowXsltScript" is only supported in MSXML 3.0 SP4+ and 3.0 SP8+ respectively.</span><span class="WHIT">
<span class='line'>242</span>         </span><span class="PUNC">}</span><span class="WHIT"> 
<span class='line'>243</span>         </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">xslDoc.url</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">xslDoc.selectSingleNode</span><span class="PUNC">(</span><span class="STRN">"//xsl:*[local-name() = 'import' or local-name() = 'include']"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>244</span>             </span><span class="NAME">converted.async</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>245</span>             </span><span class="NAME">converted.load</span><span class="PUNC">(</span><span class="NAME">xslDoc.url</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>246</span>         </span><span class="PUNC">}</span><span class="WHIT"> 
<span class='line'>247</span>         </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>248</span>             </span><span class="NAME">converted.loadXML</span><span class="PUNC">(</span><span class="NAME">xslDoc.xml</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>249</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>250</span>         </span><span class="NAME">converted.setProperty</span><span class="PUNC">(</span><span class="STRN">"SelectionNamespaces"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"xmlns:xsl='http://www.w3.org/1999/XSL/Transform'"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>251</span>         </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">output</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">converted.selectSingleNode</span><span class="PUNC">(</span><span class="STRN">"//xsl:output"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>252</span>         </span><span class="COMM">//this.outputMethod = output ? output.getAttribute("method") : "html";</span><span class="WHIT">
<span class='line'>253</span>         </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">output</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>254</span>             </span><span class="NAME">this.outputMethod</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">output.getAttribute</span><span class="PUNC">(</span><span class="STRN">"method"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>255</span>         </span><span class="PUNC">}</span><span class="WHIT"> 
<span class='line'>256</span>         </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>257</span>             </span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this.outputMethod</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>258</span>         </span><span class="PUNC">}</span><span class="WHIT"> 
<span class='line'>259</span>         </span><span class="NAME">this.template.stylesheet</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">converted</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>260</span>         </span><span class="NAME">this.processor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.template.createProcessor</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>261</span>         </span><span class="COMM">// for getParameter and clearParameters</span><span class="WHIT">
<span class='line'>262</span>         </span><span class="NAME">this.paramsSet</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>263</span>     </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>264</span> 
<span class='line'>265</span>     </span><span class="COMM">/**
<span class='line'>266</span>      * Transform the given XML DOM and return the transformation result as a new DOM document
<span class='line'>267</span>      * @param {DOMDocument} sourceDoc The XML DOMDocument to transform
<span class='line'>268</span>      * @return {DOMDocument} The transformation result as a DOM Document
<span class='line'>269</span>      */</span><span class="WHIT">
<span class='line'>270</span>     </span><span class="NAME">XSLTProcessor.prototype.transformToDocument</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">sourceDoc</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>271</span>         </span><span class="COMM">// fix for bug 1549749</span><span class="WHIT">
<span class='line'>272</span>         </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">outDoc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>273</span>         </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">_SARISSA_THREADEDDOM_PROGID</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>274</span>             </span><span class="NAME">this.processor.input</span><span class="PUNC">=</span><span class="NAME">sourceDoc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>275</span>             </span><span class="NAME">outDoc</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">ActiveXObject</span><span class="PUNC">(</span><span class="NAME">_SARISSA_DOM_PROGID</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>276</span>             </span><span class="NAME">this.processor.output</span><span class="PUNC">=</span><span class="NAME">outDoc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>277</span>             </span><span class="NAME">this.processor.transform</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>278</span>             </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">outDoc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>279</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>280</span>         </span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>281</span>             </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">_SARISSA_DOM_XMLWRITER</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>282</span>                 </span><span class="NAME">_SARISSA_DOM_XMLWRITER</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Sarissa.pickRecentProgID</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="STRN">"Msxml2.MXXMLWriter.6.0"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"Msxml2.MXXMLWriter.3.0"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"MSXML2.MXXMLWriter"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"MSXML.MXXMLWriter"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"Microsoft.XMLDOM"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>283</span>             </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>284</span>             </span><span class="NAME">this.processor.input</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sourceDoc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>285</span>             </span><span class="NAME">outDoc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">ActiveXObject</span><span class="PUNC">(</span><span class="NAME">_SARISSA_DOM_XMLWRITER</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>286</span>             </span><span class="NAME">this.processor.output</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">outDoc</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>287</span>             </span><span class="NAME">this.processor.transform</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>288</span>             </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">oDoc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">ActiveXObject</span><span class="PUNC">(</span><span class="NAME">_SARISSA_DOM_PROGID</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>289</span>             </span><span class="NAME">oDoc.loadXML</span><span class="PUNC">(</span><span class="NAME">outDoc.output</span><span class="PUNC">+</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>290</span>             </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">oDoc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>291</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>292</span>     </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>293</span>     
<span class='line'>294</span>     </span><span class="COMM">/**
<span class='line'>295</span>      * Transform the given XML DOM and return the transformation result as a new DOM fragment.
<span class='line'>296</span>      * &lt;b>Note&lt;/b>: The xsl:output method must match the nature of the owner document (XML/HTML).
<span class='line'>297</span>      * @param {DOMDocument} sourceDoc The XML DOMDocument to transform
<span class='line'>298</span>      * @param {DOMDocument} ownerDoc The owner of the result fragment
<span class='line'>299</span>      * @return {DOMDocument} The transformation result as a DOM Document
<span class='line'>300</span>      */</span><span class="WHIT">
<span class='line'>301</span>     </span><span class="NAME">XSLTProcessor.prototype.transformToFragment</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sourceDoc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ownerDoc</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>302</span>         </span><span class="NAME">this.processor.input</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sourceDoc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>303</span>         </span><span class="NAME">this.processor.transform</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>304</span>         </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.processor.output</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>305</span>         </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">f</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ownerDoc.createDocumentFragment</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>306</span>         </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">container</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>307</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.outputMethod</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'text'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>308</span>             </span><span class="NAME">f.appendChild</span><span class="PUNC">(</span><span class="NAME">ownerDoc.createTextNode</span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>309</span>         </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ownerDoc.body</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">ownerDoc.body.innerHTML</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>310</span>             </span><span class="NAME">container</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ownerDoc.createElement</span><span class="PUNC">(</span><span class="STRN">'div'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>311</span>             </span><span class="NAME">container.innerHTML</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>312</span>             </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">container.hasChildNodes</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>313</span>                 </span><span class="NAME">f.appendChild</span><span class="PUNC">(</span><span class="NAME">container.firstChild</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>314</span>             </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>315</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>316</span>         </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>317</span>             </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">oDoc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">ActiveXObject</span><span class="PUNC">(</span><span class="NAME">_SARISSA_DOM_PROGID</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>318</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s.substring</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">5</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'&lt;?xml'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>319</span>                 </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s.substring</span><span class="PUNC">(</span><span class="NAME">s.indexOf</span><span class="PUNC">(</span><span class="STRN">'?>'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>320</span>             </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>321</span>             </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">xml</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">.</span><span class="NAME">concat</span><span class="PUNC">(</span><span class="STRN">'&lt;my>'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'&lt;/my>'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>322</span>             </span><span class="NAME">oDoc.loadXML</span><span class="PUNC">(</span><span class="NAME">xml</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>323</span>             </span><span class="NAME">container</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">oDoc.documentElement</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>324</span>             </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">container.hasChildNodes</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>325</span>                 </span><span class="NAME">f.appendChild</span><span class="PUNC">(</span><span class="NAME">container.firstChild</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>326</span>             </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>327</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>328</span>         </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">f</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>329</span>     </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>330</span>     
<span class='line'>331</span>     </span><span class="COMM">/**
<span class='line'>332</span>      * Set global XSLT parameter of the imported stylesheet. This method should 
<span class='line'>333</span>      * only be used &lt;strong>after&lt;/strong> the importStylesheet method for the 
<span class='line'>334</span>      * context XSLTProcessor instance.
<span class='line'>335</span>      * @param {String} nsURI The parameter namespace URI
<span class='line'>336</span>      * @param {String} name The parameter base name
<span class='line'>337</span>      * @param {String} value The new parameter value
<span class='line'>338</span>      */</span><span class="WHIT">
<span class='line'>339</span>      </span><span class="NAME">XSLTProcessor.prototype.setParameter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">nsURI</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">name</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>340</span>          </span><span class="COMM">// make value a zero length string if null to allow clearing</span><span class="WHIT">
<span class='line'>341</span>          </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>342</span>          </span><span class="COMM">// nsURI is optional but cannot be null</span><span class="WHIT">
<span class='line'>343</span>          </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">nsURI</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>344</span>              </span><span class="NAME">this.processor.addParameter</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nsURI</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>345</span>          </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>346</span>              </span><span class="NAME">this.processor.addParameter</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>347</span>          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>348</span>          </span><span class="COMM">// update updated params for getParameter</span><span class="WHIT">
<span class='line'>349</span>          </span><span class="NAME">nsURI</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nsURI</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>350</span>          </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.paramsSet</span><span class="PUNC">[</span><span class="NAME">nsURI</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>351</span>              </span><span class="NAME">this.paramsSet</span><span class="PUNC">[</span><span class="NAME">nsURI</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>352</span>          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>353</span>          </span><span class="NAME">this.paramsSet</span><span class="PUNC">[</span><span class="NAME">nsURI</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>354</span>      </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>355</span>     </span><span class="COMM">/**
<span class='line'>356</span>      * Gets a parameter if previously set by setParameter. Returns null
<span class='line'>357</span>      * otherwise
<span class='line'>358</span>      * @param {String} name The parameter base name
<span class='line'>359</span>      * @param {String} value The new parameter value
<span class='line'>360</span>      * @return {String} The parameter value if reviously set by setParameter, null otherwise
<span class='line'>361</span>      */</span><span class="WHIT">
<span class='line'>362</span>     </span><span class="NAME">XSLTProcessor.prototype.getParameter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">nsURI</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>363</span>         </span><span class="NAME">nsURI</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nsURI</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>364</span>         </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.paramsSet</span><span class="PUNC">[</span><span class="NAME">nsURI</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.paramsSet</span><span class="PUNC">[</span><span class="NAME">nsURI</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>365</span>             </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.paramsSet</span><span class="PUNC">[</span><span class="NAME">nsURI</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>366</span>         </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>367</span>             </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>368</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>369</span>     </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>370</span>     
<span class='line'>371</span>     </span><span class="COMM">/**
<span class='line'>372</span>      * Clear parameters (set them to default values as defined in the stylesheet itself)
<span class='line'>373</span>      */</span><span class="WHIT">
<span class='line'>374</span>     </span><span class="NAME">XSLTProcessor.prototype.clearParameters</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>375</span>         </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nsURI</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this.paramsSet</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>376</span>             </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">name</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this.paramsSet</span><span class="PUNC">[</span><span class="NAME">nsURI</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>377</span>                 </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">nsURI</span><span class="PUNC">!=</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>378</span>                     </span><span class="NAME">this.processor.addParameter</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nsURI</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>379</span>                 </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>380</span>                     </span><span class="NAME">this.processor.addParameter</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>381</span>                 </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>382</span>             </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>383</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>384</span>         </span><span class="NAME">this.paramsSet</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>385</span>     </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>386</span> </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">/* end IE initialization, try to deal with real browsers now ;-) */</span><span class="WHIT">
<span class='line'>387</span>     </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">Sarissa._SARISSA_HAS_DOM_CREATE_DOCUMENT</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>388</span>         </span><span class="COMM">/**
<span class='line'>389</span>          * &lt;p>Ensures the document was loaded correctly, otherwise sets the
<span class='line'>390</span>          * parseError to -1 to indicate something went wrong. Internal use&lt;/p>
<span class='line'>391</span>          * @private
<span class='line'>392</span>          */</span><span class="WHIT">
<span class='line'>393</span>         </span><span class="NAME">Sarissa.__handleLoad__</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">oDoc</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>394</span>             </span><span class="NAME">Sarissa.__setReadyState__</span><span class="PUNC">(</span><span class="NAME">oDoc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>395</span>         </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>396</span>         </span><span class="COMM">/**
<span class='line'>397</span>         * &lt;p>Attached by an event handler to the load event. Internal use.&lt;/p>
<span class='line'>398</span>         * @private
<span class='line'>399</span>         */</span><span class="WHIT">
<span class='line'>400</span>         </span><span class="NAME">_sarissa_XMLDocument_onload</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>401</span>             </span><span class="NAME">Sarissa.__handleLoad__</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>402</span>         </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>403</span>         </span><span class="COMM">/**
<span class='line'>404</span>          * &lt;p>Sets the readyState property of the given DOM Document object.
<span class='line'>405</span>          * Internal use.&lt;/p>
<span class='line'>406</span>          * @memberOf Sarissa
<span class='line'>407</span>          * @private
<span class='line'>408</span>          * @param oDoc the DOM Document object to fire the
<span class='line'>409</span>          *          readystatechange event
<span class='line'>410</span>          * @param iReadyState the number to change the readystate property to
<span class='line'>411</span>          */</span><span class="WHIT">
<span class='line'>412</span>         </span><span class="NAME">Sarissa.__setReadyState__</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">oDoc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">iReadyState</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>413</span>             </span><span class="NAME">oDoc.readyState</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">iReadyState</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>414</span>             </span><span class="NAME">oDoc.readystate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">iReadyState</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>415</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">oDoc.onreadystatechange</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">oDoc.onreadystatechange</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"function"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>416</span>                 </span><span class="NAME">oDoc.onreadystatechange</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>417</span>             </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>418</span>         </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>419</span>         
<span class='line'>420</span>         </span><span class="NAME">Sarissa.getDomDocument</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">sUri</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sName</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>421</span>             </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">oDoc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.implementation.createDocument</span><span class="PUNC">(</span><span class="NAME">sUri</span><span class="PUNC">?</span><span class="NAME">sUri</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sName</span><span class="PUNC">?</span><span class="NAME">sName</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>422</span>             </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">oDoc.onreadystatechange</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>423</span>             
<span class='line'>424</span>                 </span><span class="COMM">/**
<span class='line'>425</span>                 * &lt;p>Emulate IE's onreadystatechange attribute&lt;/p>
<span class='line'>426</span>                 */</span><span class="WHIT">
<span class='line'>427</span>                 </span><span class="NAME">oDoc.onreadystatechange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>428</span>             </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>429</span>             </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">oDoc.readyState</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>430</span>                 </span><span class="COMM">/**
<span class='line'>431</span>                 * &lt;p>Emulates IE's readyState property, which always gives an integer from 0 to 4:&lt;/p>
<span class='line'>432</span>                 * &lt;ul>&lt;li>1 == LOADING,&lt;/li>
<span class='line'>433</span>                 * &lt;li>2 == LOADED,&lt;/li>
<span class='line'>434</span>                 * &lt;li>3 == INTERACTIVE,&lt;/li>
<span class='line'>435</span>                 * &lt;li>4 == COMPLETED&lt;/li>&lt;/ul>
<span class='line'>436</span>                 */</span><span class="WHIT">
<span class='line'>437</span>                 </span><span class="NAME">oDoc.readyState</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>438</span>             </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>439</span>             </span><span class="NAME">oDoc.addEventListener</span><span class="PUNC">(</span><span class="STRN">"load"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_sarissa_XMLDocument_onload</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>440</span>             </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">oDoc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>441</span>         </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>442</span>         </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">window.XMLDocument</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>443</span>             </span><span class="COMM">// do nothing</span><span class="WHIT">
<span class='line'>444</span>         </span><span class="PUNC">}</span><span class="COMM">// TODO: check if the new document has content before trying to copynodes, check  for error handling in DOM 3 LS</span><span class="WHIT">
<span class='line'>445</span>         </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">Sarissa._SARISSA_HAS_DOM_FEATURE</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">window.Document</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">Document.prototype.load</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">document.implementation.hasFeature</span><span class="PUNC">(</span><span class="STRN">'LS'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'3.0'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>446</span>     		</span><span class="COMM">//Opera 9 may get the XPath branch which gives creates XMLDocument, therefore it doesn't reach here which is good</span><span class="WHIT">
<span class='line'>447</span>             </span><span class="COMM">/**
<span class='line'>448</span>             * &lt;p>Factory method to obtain a new DOM Document object&lt;/p>
<span class='line'>449</span>             * @memberOf Sarissa
<span class='line'>450</span>             * @param {String} sUri the namespace of the root node (if any)
<span class='line'>451</span>             * @param {String} sUri the local name of the root node (if any)
<span class='line'>452</span>             * @returns {DOMDOcument} a new DOM Document
<span class='line'>453</span>             */</span><span class="WHIT">
<span class='line'>454</span>             </span><span class="NAME">Sarissa.getDomDocument</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">sUri</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sName</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>455</span>                 </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">oDoc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.implementation.createDocument</span><span class="PUNC">(</span><span class="NAME">sUri</span><span class="PUNC">?</span><span class="NAME">sUri</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sName</span><span class="PUNC">?</span><span class="NAME">sName</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>456</span>                 </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">oDoc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>457</span>             </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>458</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>459</span>         </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>460</span>             </span><span class="NAME">Sarissa.getDomDocument</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">sUri</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sName</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>461</span>                 </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">oDoc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.implementation.createDocument</span><span class="PUNC">(</span><span class="NAME">sUri</span><span class="PUNC">?</span><span class="NAME">sUri</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sName</span><span class="PUNC">?</span><span class="NAME">sName</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>462</span>                 </span><span class="COMM">// looks like safari does not create the root element for some unknown reason</span><span class="WHIT">
<span class='line'>463</span>                 </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">oDoc</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sUri</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">sName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">oDoc.documentElement</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>464</span>                     </span><span class="NAME">oDoc.appendChild</span><span class="PUNC">(</span><span class="NAME">oDoc.createElementNS</span><span class="PUNC">(</span><span class="NAME">sUri</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sName</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>465</span>                 </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>466</span>                 </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">oDoc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>467</span>             </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>468</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>469</span>     </span><span class="PUNC">}</span><span class="COMM">//if(Sarissa._SARISSA_HAS_DOM_CREATE_DOCUMENT)</span><span class="WHIT">
<span class='line'>470</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>471</span> </span><span class="COMM">//==========================================</span><span class="WHIT">
<span class='line'>472</span> </span><span class="COMM">// Common stuff</span><span class="WHIT">
<span class='line'>473</span> </span><span class="COMM">//==========================================</span><span class="WHIT">
<span class='line'>474</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">window.DOMParser</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>475</span>     </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">Sarissa._SARISSA_IS_SAFARI</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>476</span>         </span><span class="COMM">/**
<span class='line'>477</span>          * DOMParser is a utility class, used to construct DOMDocuments from XML strings
<span class='line'>478</span>          * @constructor
<span class='line'>479</span>          */</span><span class="WHIT">
<span class='line'>480</span>         </span><span class="NAME">DOMParser</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>481</span>         </span><span class="COMM">/** 
<span class='line'>482</span>         * Construct a new DOM Document from the given XMLstring
<span class='line'>483</span>         * @param {String} sXml the given XML string
<span class='line'>484</span>         * @param {String} contentType the content type of the document the given string represents (one of text/xml, application/xml, application/xhtml+xml). 
<span class='line'>485</span>         * @return {DOMDocument} a new DOM Document from the given XML string
<span class='line'>486</span>         */</span><span class="WHIT">
<span class='line'>487</span>         </span><span class="NAME">DOMParser.prototype.parseFromString</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">sXml</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">contentType</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>488</span>             </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">xmlhttp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">XMLHttpRequest</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>489</span>             </span><span class="NAME">xmlhttp.open</span><span class="PUNC">(</span><span class="STRN">"GET"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"data:text/xml;charset=utf-8,"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">encodeURIComponent</span><span class="PUNC">(</span><span class="NAME">sXml</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>490</span>             </span><span class="NAME">xmlhttp.send</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>491</span>             </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">xmlhttp.responseXML</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>492</span>         </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>493</span>     </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">Sarissa.getDomDocument</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">Sarissa.getDomDocument</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">Sarissa.getDomDocument</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"bar"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">xml</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>494</span>         </span><span class="NAME">DOMParser</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>495</span>         </span><span class="NAME">DOMParser.prototype.parseFromString</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">sXml</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">contentType</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>496</span>             </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">doc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Sarissa.getDomDocument</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>497</span>             </span><span class="KEYW">try</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>498</span>             	</span><span class="NAME">doc.validateOnParse</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>499</span>             	</span><span class="NAME">doc.setProperty</span><span class="PUNC">(</span><span class="STRN">"ProhibitDTD"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>500</span>             </span><span class="PUNC">}</span><span class="KEYW">catch</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>501</span>             </span><span class="NAME">doc.loadXML</span><span class="PUNC">(</span><span class="NAME">sXml</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>502</span>             </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">doc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>503</span>         </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>504</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>505</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>506</span> 
<span class='line'>507</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="PUNC">(</span><span class="NAME">document.importNode</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">Sarissa._SARISSA_IS_IE</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>508</span>     </span><span class="KEYW">try</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>509</span>         </span><span class="COMM">/**
<span class='line'>510</span>         * Implementation of importNode for the context window document in IE.
<span class='line'>511</span>         * If &lt;code>oNode&lt;/code> is a TextNode, &lt;code>bChildren&lt;/code> is ignored.
<span class='line'>512</span>         * @param {DOMNode} oNode the Node to import
<span class='line'>513</span>         * @param {boolean} bChildren whether to include the children of oNode
<span class='line'>514</span>         * @returns the imported node for further use
<span class='line'>515</span>         */</span><span class="WHIT">
<span class='line'>516</span>         </span><span class="NAME">document.importNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">oNode</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">bChildren</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>517</span>             </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tmp</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>518</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">oNode.nodeName</span><span class="PUNC">==</span><span class="STRN">'#text'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>519</span>                 </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">document.createTextNode</span><span class="PUNC">(</span><span class="NAME">oNode.data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>520</span>             </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>521</span>             </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>522</span>                 </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">oNode.nodeName</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"tbody"</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">oNode.nodeName</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"tr"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>523</span>                     </span><span class="NAME">tmp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">"table"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>524</span>                 </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>525</span>                 </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">oNode.nodeName</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"td"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>526</span>                     </span><span class="NAME">tmp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">"tr"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>527</span>                 </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>528</span>                 </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">oNode.nodeName</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"option"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>529</span>                     </span><span class="NAME">tmp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">"select"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>530</span>                 </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>531</span>                 </span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>532</span>                     </span><span class="NAME">tmp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">"div"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>533</span>                 </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>534</span>                 </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">bChildren</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>535</span>                     </span><span class="NAME">tmp.innerHTML</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">oNode.xml</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">oNode.xml</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">oNode.outerHTML</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>536</span>                 </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>537</span>                     </span><span class="NAME">tmp.innerHTML</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">oNode.xml</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">oNode.cloneNode</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">xml</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">oNode.cloneNode</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">outerHTML</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>538</span>                 </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>539</span>                 </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">tmp.getElementsByTagName</span><span class="PUNC">(</span><span class="STRN">"*"</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>540</span>             </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>541</span>         </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>542</span>     </span><span class="PUNC">}</span><span class="KEYW">catch</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>543</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>544</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">Sarissa.getParseErrorText</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>545</span>     </span><span class="COMM">/**
<span class='line'>546</span>      * &lt;p>Returns a human readable description of the parsing error. Usefull
<span class='line'>547</span>      * for debugging. Tip: append the returned error string in a &lt;pre&gt;
<span class='line'>548</span>      * element if you want to render it.&lt;/p>
<span class='line'>549</span>      * &lt;p>Many thanks to Christian Stocker for the initial patch.&lt;/p>
<span class='line'>550</span>      * @memberOf Sarissa
<span class='line'>551</span>      * @param {DOMDocument} oDoc The target DOM document
<span class='line'>552</span>      * @returns {String} The parsing error description of the target Document in
<span class='line'>553</span>      *          human readable form (preformated text)
<span class='line'>554</span>      */</span><span class="WHIT">
<span class='line'>555</span>     </span><span class="NAME">Sarissa.getParseErrorText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">oDoc</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>556</span>         </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">parseErrorText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Sarissa.PARSED_OK</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>557</span>         </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">oDoc</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">oDoc.documentElement</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>558</span>             </span><span class="NAME">parseErrorText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Sarissa.PARSED_EMPTY</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>559</span>         </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">oDoc.documentElement.tagName</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"parsererror"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>560</span>             </span><span class="NAME">parseErrorText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">oDoc.documentElement.firstChild.data</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>561</span>             </span><span class="NAME">parseErrorText</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"\n"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT">  </span><span class="NAME">oDoc.documentElement.firstChild.nextSibling.firstChild.data</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>562</span>         </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">oDoc.getElementsByTagName</span><span class="PUNC">(</span><span class="STRN">"parsererror"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>563</span>             </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">parsererror</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">oDoc.getElementsByTagName</span><span class="PUNC">(</span><span class="STRN">"parsererror"</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>564</span>             </span><span class="NAME">parseErrorText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Sarissa.getText</span><span class="PUNC">(</span><span class="NAME">parsererror</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"\n"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>565</span>         </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">oDoc.parseError</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">oDoc.parseError.errorCode</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>566</span>             </span><span class="NAME">parseErrorText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Sarissa.PARSED_UNKNOWN_ERROR</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>567</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>568</span>         </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">parseErrorText</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>569</span>     </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>570</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>571</span> </span><span class="COMM">/**
<span class='line'>572</span>  * Get a string with the concatenated values of all string nodes under the given node
<span class='line'>573</span>  * @param {DOMNode} oNode the given DOM node
<span class='line'>574</span>  * @param {boolean} deep whether to recursively scan the children nodes of the given node for text as well. Default is &lt;code>false&lt;/code>
<span class='line'>575</span>  * @memberOf Sarissa 
<span class='line'>576</span>  */</span><span class="WHIT">
<span class='line'>577</span> </span><span class="NAME">Sarissa.getText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">oNode</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">deep</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>578</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>579</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nodes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">oNode.childNodes</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>580</span>     </span><span class="COMM">// opera fix, finds no child text node for attributes so we use .value</span><span class="WHIT">
<span class='line'>581</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">oNode.nodeType</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">Node.ATTRIBUTE_NODE</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">nodes.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>582</span>         </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">oNode.value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>583</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>584</span>     </span><span class="COMM">// END opera fix</span><span class="WHIT">
<span class='line'>585</span>     </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">nodes.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>586</span>         </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">node</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nodes</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>587</span>         </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nodeType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">node.nodeType</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>588</span>         </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">nodeType</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">Node.TEXT_NODE</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">nodeType</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">Node.CDATA_SECTION_NODE</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>589</span>             </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">node.data</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>590</span>         </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">deep</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nodeType</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">Node.ELEMENT_NODE</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">nodeType</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">Node.DOCUMENT_NODE</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">nodeType</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">Node.DOCUMENT_FRAGMENT_NODE</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>591</span>             </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Sarissa.getText</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>592</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>593</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>594</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>595</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>596</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">window.XMLSerializer</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">Sarissa.getDomDocument</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">Sarissa.getDomDocument</span><span class="PUNC">(</span><span class="STRN">""</span><span class="PUNC">,</span><span class="STRN">"foo"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">xml</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>597</span>     </span><span class="COMM">/**
<span class='line'>598</span>      * Utility class to serialize DOM Node objects to XML strings
<span class='line'>599</span>      * @constructor
<span class='line'>600</span>      */</span><span class="WHIT">
<span class='line'>601</span>     </span><span class="NAME">XMLSerializer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>602</span>     </span><span class="COMM">/**
<span class='line'>603</span>      * Serialize the given DOM Node to an XML string
<span class='line'>604</span>      * @param {DOMNode} oNode the DOM Node to serialize
<span class='line'>605</span>      */</span><span class="WHIT">
<span class='line'>606</span>     </span><span class="NAME">XMLSerializer.prototype.serializeToString</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">oNode</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>607</span>         </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">oNode.xml</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>608</span>     </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>609</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>610</span> 
<span class='line'>611</span> </span><span class="COMM">/**
<span class='line'>612</span>  * Strips tags from the given markup string. If the given string is 
<span class='line'>613</span>  * &lt;code>undefined&lt;/code>, &lt;code>null&lt;/code> or empty, it is returned as is. 
<span class='line'>614</span>  * @memberOf Sarissa
<span class='line'>615</span>  * @param {String} s the string to strip the tags from
<span class='line'>616</span>  */</span><span class="WHIT">
<span class='line'>617</span> </span><span class="NAME">Sarissa.stripTags</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>618</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">?</span><span class="NAME">s.replace</span><span class="PUNC">(</span><span class="REGX">/&lt;[^>]+>/g</span><span class="PUNC">,</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">s</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>619</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>620</span> </span><span class="COMM">/**
<span class='line'>621</span>  * &lt;p>Deletes all child nodes of the given node&lt;/p>
<span class='line'>622</span>  * @memberOf Sarissa
<span class='line'>623</span>  * @param {DOMNode} oNode the Node to empty
<span class='line'>624</span>  */</span><span class="WHIT">
<span class='line'>625</span> </span><span class="NAME">Sarissa.clearChildNodes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">oNode</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>626</span>     </span><span class="COMM">// need to check for firstChild due to opera 8 bug with hasChildNodes</span><span class="WHIT">
<span class='line'>627</span>     </span><span class="KEYW">while</span><span class="PUNC">(</span><span class="NAME">oNode.firstChild</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>628</span>         </span><span class="NAME">oNode.removeChild</span><span class="PUNC">(</span><span class="NAME">oNode.firstChild</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>629</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>630</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>631</span> </span><span class="COMM">/**
<span class='line'>632</span>  * &lt;p> Copies the childNodes of nodeFrom to nodeTo&lt;/p>
<span class='line'>633</span>  * &lt;p> &lt;b>Note:&lt;/b> The second object's original content is deleted before 
<span class='line'>634</span>  * the copy operation, unless you supply a true third parameter&lt;/p>
<span class='line'>635</span>  * @memberOf Sarissa
<span class='line'>636</span>  * @param {DOMNode} nodeFrom the Node to copy the childNodes from
<span class='line'>637</span>  * @param {DOMNode} nodeTo the Node to copy the childNodes to
<span class='line'>638</span>  * @param {boolean} bPreserveExisting whether to preserve the original content of nodeTo, default is false
<span class='line'>639</span>  */</span><span class="WHIT">
<span class='line'>640</span> </span><span class="NAME">Sarissa.copyChildNodes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">nodeFrom</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nodeTo</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">bPreserveExisting</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>641</span>     </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">Sarissa._SARISSA_IS_SAFARI</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">nodeTo.nodeType</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">Node.DOCUMENT_NODE</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// SAFARI_OLD ??</span><span class="WHIT">
<span class='line'>642</span>     	</span><span class="NAME">nodeTo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nodeTo.documentElement</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">//Apparently there's a bug in safari where you can't appendChild to a document node</span><span class="WHIT">
<span class='line'>643</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>644</span>     
<span class='line'>645</span>     </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">nodeFrom</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">nodeTo</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>646</span>         </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="STRN">"Both source and destination nodes must be provided"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>647</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>648</span>     </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">bPreserveExisting</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>649</span>         </span><span class="NAME">Sarissa.clearChildNodes</span><span class="PUNC">(</span><span class="NAME">nodeTo</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>650</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>651</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ownerDoc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nodeTo.nodeType</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">Node.DOCUMENT_NODE</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">nodeTo</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">nodeTo.ownerDocument</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>652</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nodes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nodeFrom.childNodes</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>653</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>654</span>     </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="PUNC">(</span><span class="NAME">ownerDoc.importNode</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="WHIT">  </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>655</span>         </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">nodes.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>656</span>             </span><span class="NAME">nodeTo.appendChild</span><span class="PUNC">(</span><span class="NAME">ownerDoc.importNode</span><span class="PUNC">(</span><span class="NAME">nodes</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>657</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>658</span>     </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>659</span>         </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">nodes.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>660</span>             </span><span class="NAME">nodeTo.appendChild</span><span class="PUNC">(</span><span class="NAME">nodes</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">cloneNode</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>661</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>662</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>663</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>664</span> 
<span class='line'>665</span> </span><span class="COMM">/**
<span class='line'>666</span>  * &lt;p> Moves the childNodes of nodeFrom to nodeTo&lt;/p>
<span class='line'>667</span>  * &lt;p> &lt;b>Note:&lt;/b> The second object's original content is deleted before 
<span class='line'>668</span>  * the move operation, unless you supply a true third parameter&lt;/p>
<span class='line'>669</span>  * @memberOf Sarissa
<span class='line'>670</span>  * @param {DOMNode} nodeFrom the Node to copy the childNodes from
<span class='line'>671</span>  * @param {DOMNode} nodeTo the Node to copy the childNodes to
<span class='line'>672</span>  * @param {boolean} bPreserveExisting whether to preserve the original content of nodeTo, default is
<span class='line'>673</span>  */</span><span class="WHIT"> 
<span class='line'>674</span> </span><span class="NAME">Sarissa.moveChildNodes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">nodeFrom</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nodeTo</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">bPreserveExisting</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>675</span>     </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">nodeFrom</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">nodeTo</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>676</span>         </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="STRN">"Both source and destination nodes must be provided"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>677</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>678</span>     </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">bPreserveExisting</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>679</span>         </span><span class="NAME">Sarissa.clearChildNodes</span><span class="PUNC">(</span><span class="NAME">nodeTo</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>680</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>681</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nodes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nodeFrom.childNodes</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>682</span>     </span><span class="COMM">// if within the same doc, just move, else copy and delete</span><span class="WHIT">
<span class='line'>683</span>     </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">nodeFrom.ownerDocument</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">nodeTo.ownerDocument</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>684</span>         </span><span class="KEYW">while</span><span class="PUNC">(</span><span class="NAME">nodeFrom.firstChild</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>685</span>             </span><span class="NAME">nodeTo.appendChild</span><span class="PUNC">(</span><span class="NAME">nodeFrom.firstChild</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>686</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>687</span>     </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>688</span>         </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ownerDoc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nodeTo.nodeType</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">Node.DOCUMENT_NODE</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">nodeTo</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">nodeTo.ownerDocument</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>689</span>         </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>690</span>         </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="PUNC">(</span><span class="NAME">ownerDoc.importNode</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>691</span>            </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">nodes.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>692</span>                </span><span class="NAME">nodeTo.appendChild</span><span class="PUNC">(</span><span class="NAME">ownerDoc.importNode</span><span class="PUNC">(</span><span class="NAME">nodes</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>693</span>            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>694</span>         </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>695</span>            </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">nodes.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>696</span>                </span><span class="NAME">nodeTo.appendChild</span><span class="PUNC">(</span><span class="NAME">nodes</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">cloneNode</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>697</span>            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>698</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>699</span>         </span><span class="NAME">Sarissa.clearChildNodes</span><span class="PUNC">(</span><span class="NAME">nodeFrom</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>700</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>701</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>702</span> 
<span class='line'>703</span> </span><span class="COMM">/** 
<span class='line'>704</span>  * &lt;p>Serialize any &lt;strong>non&lt;/strong> DOM object to an XML string. All properties are serialized using the property name
<span class='line'>705</span>  * as the XML element name. Array elements are rendered as &lt;code>array-item&lt;/code> elements, 
<span class='line'>706</span>  * using their index/key as the value of the &lt;code>key&lt;/code> attribute.&lt;/p>
<span class='line'>707</span>  * @memberOf Sarissa
<span class='line'>708</span>  * @param {Object} anyObject the object to serialize
<span class='line'>709</span>  * @param {String} objectName a name for that object, to be used as the root element name
<span class='line'>710</span>  * @param {String} indentSpace Optional, the indentation space to use, default is an empty 
<span class='line'>711</span>  *        string. A single space character is added in any recursive call.
<span class='line'>712</span>  * @param {noolean} skipEscape Optional, whether to skip escaping characters that map to the 
<span class='line'>713</span>  *        five predefined XML entities. Default is &lt;code>false&lt;/code>.
<span class='line'>714</span>  * @return {String} the XML serialization of the given object as a string
<span class='line'>715</span>  */</span><span class="WHIT">
<span class='line'>716</span> </span><span class="NAME">Sarissa.xmlize</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">anyObject</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">objectName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">indentSpace</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">skipEscape</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>717</span>     </span><span class="NAME">indentSpace</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">indentSpace</span><span class="PUNC">?</span><span class="NAME">indentSpace</span><span class="PUNC">:</span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>718</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">indentSpace</span><span class="WHIT">  </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'&lt;'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">objectName</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'>'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>719</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">isLeaf</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>720</span>     </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">anyObject</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">anyObject</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Number</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">anyObject</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">String</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">anyObject</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Boolean</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">anyObject</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>721</span>         </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">skipEscape</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">Sarissa.escape</span><span class="PUNC">(</span><span class="NAME">anyObject</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">anyObject</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>722</span>         </span><span class="NAME">isLeaf</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>723</span>     </span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>724</span>         </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"\n"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>725</span>         </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">isArrayItem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">anyObject</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>726</span>         </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">name</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">anyObject</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>727</span>         	</span><span class="COMM">// do not xmlize functions </span><span class="WHIT">
<span class='line'>728</span>         	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">anyObject</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Function</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>729</span>         		</span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>730</span>         	</span><span class="PUNC">}</span><span class="WHIT"> 
<span class='line'>731</span>             </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Sarissa.xmlize</span><span class="PUNC">(</span><span class="NAME">anyObject</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isArrayItem</span><span class="PUNC">?</span><span class="STRN">"array-item key=\""</span><span class="PUNC">+</span><span class="NAME">name</span><span class="PUNC">+</span><span class="STRN">"\""</span><span class="PUNC">:</span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">indentSpace</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" "</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>732</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>733</span>         </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">indentSpace</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>734</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>735</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">objectName.indexOf</span><span class="PUNC">(</span><span class="STRN">' '</span><span class="PUNC">)</span><span class="PUNC">!=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">?</span><span class="STRN">"&lt;/array-item>\n"</span><span class="PUNC">:</span><span class="STRN">"&lt;/"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">objectName</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">">\n"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>736</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>737</span> 
<span class='line'>738</span> </span><span class="COMM">/** 
<span class='line'>739</span>  * Escape the given string chacters that correspond to the five predefined XML entities
<span class='line'>740</span>  * @memberOf Sarissa
<span class='line'>741</span>  * @param {String} sXml the string to escape
<span class='line'>742</span>  */</span><span class="WHIT">
<span class='line'>743</span> </span><span class="NAME">Sarissa.escape</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">sXml</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>744</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">sXml.replace</span><span class="PUNC">(</span><span class="REGX">/&/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"&amp;"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/&lt;/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"&lt;"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/>/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"&gt;"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/"/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"&quot;"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/'/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"&apos;"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>745</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>746</span> 
<span class='line'>747</span> </span><span class="COMM">/** 
<span class='line'>748</span>  * Unescape the given string. This turns the occurences of the predefined XML 
<span class='line'>749</span>  * entities to become the characters they represent correspond to the five predefined XML entities
<span class='line'>750</span>  * @memberOf Sarissa
<span class='line'>751</span>  * @param  {String}sXml the string to unescape
<span class='line'>752</span>  */</span><span class="WHIT">
<span class='line'>753</span> </span><span class="NAME">Sarissa.unescape</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">sXml</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>754</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">sXml.replace</span><span class="PUNC">(</span><span class="REGX">/&apos;/g</span><span class="PUNC">,</span><span class="STRN">"'"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/&quot;/g</span><span class="PUNC">,</span><span class="STRN">"\""</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/&gt;/g</span><span class="PUNC">,</span><span class="STRN">">"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/&lt;/g</span><span class="PUNC">,</span><span class="STRN">"&lt;"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/&amp;/g</span><span class="PUNC">,</span><span class="STRN">"&"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>755</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>756</span> 
<span class='line'>757</span> </span><span class="COMM">/** @private */</span><span class="WHIT">
<span class='line'>758</span> </span><span class="NAME">Sarissa.updateCursor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">oTargetElement</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sValue</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>759</span>     </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">oTargetElement</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">oTargetElement.style</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">oTargetElement.style.cursor</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>760</span>         </span><span class="NAME">oTargetElement.style.cursor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sValue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>761</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>762</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>763</span> 
<span class='line'>764</span> </span><span class="COMM">/**
<span class='line'>765</span>  * Asynchronously update an element with response of a GET request on the given URL.  Passing a configured XSLT 
<span class='line'>766</span>  * processor will result in transforming and updating oNode before using it to update oTargetElement.
<span class='line'>767</span>  * You can also pass a callback function to be executed when the update is finished. The function will be called as 
<span class='line'>768</span>  * &lt;code>functionName(oNode, oTargetElement);&lt;/code>
<span class='line'>769</span>  * @memberOf Sarissa
<span class='line'>770</span>  * @param {String} sFromUrl the URL to make the request to
<span class='line'>771</span>  * @param {DOMElement} oTargetElement the element to update
<span class='line'>772</span>  * @param {XSLTProcessor} xsltproc (optional) the transformer to use on the returned
<span class='line'>773</span>  *                  content before updating the target element with it
<span class='line'>774</span>  * @param {Function} callback (optional) a Function object to execute once the update is finished successfuly, called as &lt;code>callback(sFromUrl, oTargetElement)&lt;/code>. 
<span class='line'>775</span>  *        In case an exception is thrown during execution, the callback is called as called as &lt;code>callback(sFromUrl, oTargetElement, oException)&lt;/code>
<span class='line'>776</span>  * @param {boolean} skipCache (optional) whether to skip any cache
<span class='line'>777</span>  */</span><span class="WHIT">
<span class='line'>778</span> </span><span class="NAME">Sarissa.updateContentFromURI</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">sFromUrl</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">oTargetElement</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">xsltproc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">callback</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">skipCache</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>779</span>     </span><span class="KEYW">try</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>780</span>         </span><span class="NAME">Sarissa.updateCursor</span><span class="PUNC">(</span><span class="NAME">oTargetElement</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"wait"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>781</span>         </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">xmlhttp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">XMLHttpRequest</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>782</span>         </span><span class="NAME">xmlhttp.open</span><span class="PUNC">(</span><span class="STRN">"GET"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sFromUrl</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>783</span>         </span><span class="NAME">xmlhttp.onreadystatechange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>784</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">xmlhttp.readyState</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>785</span>             	</span><span class="KEYW">try</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>786</span>             		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">oDomDoc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">xmlhttp.responseXML</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>787</span> 	            	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">oDomDoc</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">Sarissa.getParseErrorText</span><span class="PUNC">(</span><span class="NAME">oDomDoc</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">Sarissa.PARSED_OK</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>788</span> 		                </span><span class="NAME">Sarissa.updateContentFromNode</span><span class="PUNC">(</span><span class="NAME">xmlhttp.responseXML</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">oTargetElement</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">xsltproc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>789</span>         				</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">callback</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>790</span> 		                	</span><span class="NAME">callback</span><span class="PUNC">(</span><span class="NAME">sFromUrl</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">oTargetElement</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>791</span> 		                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>792</span> 	            	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>793</span> 	            	</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>794</span> 	            		</span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="NAME">Sarissa.getParseErrorText</span><span class="PUNC">(</span><span class="NAME">oDomDoc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>795</span> 	            	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>796</span>             	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>797</span>             	</span><span class="KEYW">catch</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>798</span>             		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">callback</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>799</span> 			        	</span><span class="NAME">callback</span><span class="PUNC">(</span><span class="NAME">sFromUrl</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">oTargetElement</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>800</span> 			        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>801</span> 			        </span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>802</span> 			        	</span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>803</span> 			        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>804</span>             	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>805</span>             </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>806</span>         </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>807</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">skipCache</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>808</span>              </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">oldage</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"Sat, 1 Jan 2000 00:00:00 GMT"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>809</span>              </span><span class="NAME">xmlhttp.setRequestHeader</span><span class="PUNC">(</span><span class="STRN">"If-Modified-Since"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">oldage</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>810</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>811</span>         </span><span class="NAME">xmlhttp.send</span><span class="PUNC">(</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>812</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>813</span>     </span><span class="KEYW">catch</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>814</span>         </span><span class="NAME">Sarissa.updateCursor</span><span class="PUNC">(</span><span class="NAME">oTargetElement</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"auto"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>815</span>         </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">callback</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>816</span>         	</span><span class="NAME">callback</span><span class="PUNC">(</span><span class="NAME">sFromUrl</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">oTargetElement</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>817</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>818</span>         </span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>819</span>         	</span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>820</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>821</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>822</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>823</span> 
<span class='line'>824</span> </span><span class="COMM">/**
<span class='line'>825</span>  * Update an element's content with the given DOM node. Passing a configured XSLT 
<span class='line'>826</span>  * processor will result in transforming and updating oNode before using it to update oTargetElement.
<span class='line'>827</span>  * You can also pass a callback function to be executed when the update is finished. The function will be called as 
<span class='line'>828</span>  * &lt;code>functionName(oNode, oTargetElement);&lt;/code>
<span class='line'>829</span>  * @memberOf Sarissa
<span class='line'>830</span>  * @param {DOMNode} oNode the URL to make the request to
<span class='line'>831</span>  * @param {DOMElement} oTargetElement the element to update
<span class='line'>832</span>  * @param {XSLTProcessor} xsltproc (optional) the transformer to use on the given 
<span class='line'>833</span>  *                  DOM node before updating the target element with it
<span class='line'>834</span>  */</span><span class="WHIT">
<span class='line'>835</span> </span><span class="NAME">Sarissa.updateContentFromNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">oNode</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">oTargetElement</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">xsltproc</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>836</span>     </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>837</span>         </span><span class="NAME">Sarissa.updateCursor</span><span class="PUNC">(</span><span class="NAME">oTargetElement</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"wait"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>838</span>         </span><span class="NAME">Sarissa.clearChildNodes</span><span class="PUNC">(</span><span class="NAME">oTargetElement</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>839</span>         </span><span class="COMM">// check for parsing errors</span><span class="WHIT">
<span class='line'>840</span>         </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ownerDoc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">oNode.nodeType</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">Node.DOCUMENT_NODE</span><span class="PUNC">?</span><span class="NAME">oNode</span><span class="PUNC">:</span><span class="NAME">oNode.ownerDocument</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>841</span>         </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">ownerDoc.parseError</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">ownerDoc.parseError.errorCode</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>842</span>             </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pre</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">"pre"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>843</span>             </span><span class="NAME">pre.appendChild</span><span class="PUNC">(</span><span class="NAME">document.createTextNode</span><span class="PUNC">(</span><span class="NAME">Sarissa.getParseErrorText</span><span class="PUNC">(</span><span class="NAME">ownerDoc</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>844</span>             </span><span class="NAME">oTargetElement.appendChild</span><span class="PUNC">(</span><span class="NAME">pre</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>845</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>846</span>         </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>847</span>             </span><span class="COMM">// transform if appropriate</span><span class="WHIT">
<span class='line'>848</span>             </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">xsltproc</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>849</span>                 </span><span class="NAME">oNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">xsltproc.transformToDocument</span><span class="PUNC">(</span><span class="NAME">oNode</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>850</span>             </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>851</span>             </span><span class="COMM">// be smart, maybe the user wants to display the source instead</span><span class="WHIT">
<span class='line'>852</span>             </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">oTargetElement.tagName.toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"textarea"</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">oTargetElement.tagName.toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"input"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>853</span>                 </span><span class="NAME">oTargetElement.value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">XMLSerializer</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">serializeToString</span><span class="PUNC">(</span><span class="NAME">oNode</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>854</span>             </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>855</span>             </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>856</span>                 </span><span class="COMM">// ok that was not smart; it was paranoid. Keep up the good work by trying to use DOM instead of innerHTML</span><span class="WHIT">
<span class='line'>857</span>                 </span><span class="KEYW">try</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>858</span>                     </span><span class="NAME">oTargetElement.appendChild</span><span class="PUNC">(</span><span class="NAME">oTargetElement.ownerDocument.importNode</span><span class="PUNC">(</span><span class="NAME">oNode</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>859</span>                 </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>860</span>                 </span><span class="KEYW">catch</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>861</span>                     </span><span class="NAME">oTargetElement.innerHTML</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">XMLSerializer</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">serializeToString</span><span class="PUNC">(</span><span class="NAME">oNode</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>862</span>                 </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>863</span>             </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>864</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>865</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>866</span>     </span><span class="KEYW">catch</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>867</span>     	</span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>868</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>869</span>     </span><span class="KEYW">finally</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>870</span>         </span><span class="NAME">Sarissa.updateCursor</span><span class="PUNC">(</span><span class="NAME">oTargetElement</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"auto"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>871</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>872</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>873</span> 
<span class='line'>874</span> 
<span class='line'>875</span> </span><span class="COMM">/**
<span class='line'>876</span>  * Creates an HTTP URL query string from the given HTML form data
<span class='line'>877</span>  * @memberOf Sarissa
<span class='line'>878</span>  * @param {HTMLFormElement} oForm the form to construct the query string from
<span class='line'>879</span>  */</span><span class="WHIT">
<span class='line'>880</span> </span><span class="NAME">Sarissa.formToQueryString</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">oForm</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>881</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">qs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>882</span>     </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">oForm.elements.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>883</span>         </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">oField</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">oForm.elements</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>884</span>         </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sFieldName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">oField.getAttribute</span><span class="PUNC">(</span><span class="STRN">"name"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">oField.getAttribute</span><span class="PUNC">(</span><span class="STRN">"name"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">oField.getAttribute</span><span class="PUNC">(</span><span class="STRN">"id"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>885</span>         </span><span class="COMM">// ensure we got a proper name/id and that the field is not disabled</span><span class="WHIT">
<span class='line'>886</span>         </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">sFieldName</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> 
<span class='line'>887</span>             </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">oField.disabled</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">oField.type</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"hidden"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>888</span>             </span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">oField.type</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>889</span>                 </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"hidden"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>890</span>                 </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"text"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>891</span>                 </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"textarea"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>892</span>                 </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"password"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>893</span>                     </span><span class="NAME">qs</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sFieldName</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"="</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">encodeURIComponent</span><span class="PUNC">(</span><span class="NAME">oField.value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"&"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>894</span>                     </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>895</span>                 </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"select-one"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>896</span>                     </span><span class="NAME">qs</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sFieldName</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"="</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">encodeURIComponent</span><span class="PUNC">(</span><span class="NAME">oField.options</span><span class="PUNC">[</span><span class="NAME">oField.selectedIndex</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"&"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>897</span>                     </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>898</span>                 </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"select-multiple"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>899</span>                     </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">oField.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>900</span>                         </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">optElem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">oField.options</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>901</span>                         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">optElem.selected</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>902</span>                             </span><span class="NAME">qs</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sFieldName</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"[]"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"="</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">encodeURIComponent</span><span class="PUNC">(</span><span class="NAME">optElem.value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"&"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>903</span>                         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>904</span>                      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>905</span>                      </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>906</span>                 </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"checkbox"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>907</span>                 </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"radio"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>908</span>                     </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">oField.checked</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>909</span>                         </span><span class="NAME">qs</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sFieldName</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"="</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">encodeURIComponent</span><span class="PUNC">(</span><span class="NAME">oField.value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"&"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>910</span>                     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>911</span>                     </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>912</span>             </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>913</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>914</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>915</span>     </span><span class="COMM">// return after removing last '&'</span><span class="WHIT">
<span class='line'>916</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">qs.substr</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">qs.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>917</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>918</span> 
<span class='line'>919</span> 
<span class='line'>920</span> </span><span class="COMM">/**
<span class='line'>921</span>  * Asynchronously update an element with response of an XMLHttpRequest-based emulation of a form submission. &lt;p>The form &lt;code>action&lt;/code> and 
<span class='line'>922</span>  * &lt;code>method&lt;/code> attributess will be followed. Passing a configured XSLT processor will result in 
<span class='line'>923</span>  * transforming and updating the server response before using it to update the target element.
<span class='line'>924</span>  * You can also pass a callback function to be executed when the update is finished. The function will be called as 
<span class='line'>925</span>  * &lt;code>functionName(oNode, oTargetElement);&lt;/code>&lt;/p>
<span class='line'>926</span>  * &lt;p>Here is an example of using this in a form element:&lt;/p>
<span class='line'>927</span>  * &lt;pre name="code" class="xml">
<span class='line'>928</span>  * &lt;div id="targetId"&gt; this content will be updated&lt;/div&gt;
<span class='line'>929</span>  * &lt;form action="/my/form/handler" method="post" 
<span class='line'>930</span>  *     onbeforesubmit="return Sarissa.updateContentFromForm(this, document.getElementById('targetId'));"&gt;&lt;pre>
<span class='line'>931</span>  * &lt;p>If JavaScript is supported, the form will not be submitted. Instead, Sarissa will
<span class='line'>932</span>  * scan the form and make an appropriate AJAX request, also adding a parameter 
<span class='line'>933</span>  * to signal to the server that this is an AJAX call. The parameter is 
<span class='line'>934</span>  * constructed as &lt;code>Sarissa.REMOTE_CALL_FLAG = "=true"&lt;/code> so you can change the name in your webpage
<span class='line'>935</span>  * simply by assigning another value to Sarissa.REMOTE_CALL_FLAG. If JavaScript is not supported
<span class='line'>936</span>  * the form will be submitted normally.
<span class='line'>937</span>  * @memberOf Sarissa
<span class='line'>938</span>  * @param {HTMLFormElement} oForm the form submition to emulate
<span class='line'>939</span>  * @param {DOMElement} oTargetElement the element to update
<span class='line'>940</span>  * @param {XSLTProcessor} xsltproc (optional) the transformer to use on the returned
<span class='line'>941</span>  *                  content before updating the target element with it
<span class='line'>942</span>  * @param {Function} callback (optional) a Function object to execute once the update is finished successfuly, called as &lt;code>callback(oNode, oTargetElement)&lt;/code>. 
<span class='line'>943</span>  *        In case an exception occurs during excecution and a callback function was provided, the exception is cought and the callback is called as 
<span class='line'>944</span>  *        &lt;code>callback(oForm, oTargetElement, exception)&lt;/code>
<span class='line'>945</span>  */</span><span class="WHIT">
<span class='line'>946</span> </span><span class="NAME">Sarissa.updateContentFromForm</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">oForm</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">oTargetElement</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">xsltproc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">callback</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>947</span>     </span><span class="KEYW">try</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>948</span>     	</span><span class="NAME">Sarissa.updateCursor</span><span class="PUNC">(</span><span class="NAME">oTargetElement</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"wait"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>949</span>         </span><span class="COMM">// build parameters from form fields</span><span class="WHIT">
<span class='line'>950</span>         </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Sarissa.formToQueryString</span><span class="PUNC">(</span><span class="NAME">oForm</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"&"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">Sarissa.REMOTE_CALL_FLAG</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"=true"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>951</span>         </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">xmlhttp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">XMLHttpRequest</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>952</span>         </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bUseGet</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">oForm.getAttribute</span><span class="PUNC">(</span><span class="STRN">"method"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">oForm.getAttribute</span><span class="PUNC">(</span><span class="STRN">"method"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"get"</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>953</span>         </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">bUseGet</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>954</span>             </span><span class="NAME">xmlhttp.open</span><span class="PUNC">(</span><span class="STRN">"GET"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">oForm.getAttribute</span><span class="PUNC">(</span><span class="STRN">"action"</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"?"</span><span class="PUNC">+</span><span class="NAME">params</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>955</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>956</span>         </span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>957</span>             </span><span class="NAME">xmlhttp.open</span><span class="PUNC">(</span><span class="STRN">'POST'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">oForm.getAttribute</span><span class="PUNC">(</span><span class="STRN">"action"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>958</span>             </span><span class="NAME">xmlhttp.setRequestHeader</span><span class="PUNC">(</span><span class="STRN">"Content-type"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"application/x-www-form-urlencoded"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>959</span>             </span><span class="NAME">xmlhttp.setRequestHeader</span><span class="PUNC">(</span><span class="STRN">"Content-length"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>960</span>             </span><span class="NAME">xmlhttp.setRequestHeader</span><span class="PUNC">(</span><span class="STRN">"Connection"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"close"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>961</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>962</span>         </span><span class="NAME">xmlhttp.onreadystatechange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>963</span>         	</span><span class="KEYW">try</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>964</span> 	            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">xmlhttp.readyState</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>965</span> 	            	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">oDomDoc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">xmlhttp.responseXML</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>966</span> 	            	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">oDomDoc</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">Sarissa.getParseErrorText</span><span class="PUNC">(</span><span class="NAME">oDomDoc</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">Sarissa.PARSED_OK</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>967</span> 		                </span><span class="NAME">Sarissa.updateContentFromNode</span><span class="PUNC">(</span><span class="NAME">xmlhttp.responseXML</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">oTargetElement</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">xsltproc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>968</span>         				</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">callback</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>969</span> 		                	</span><span class="NAME">callback</span><span class="PUNC">(</span><span class="NAME">oForm</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">oTargetElement</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>970</span> 		                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>971</span> 	            	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>972</span> 	            	</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>973</span> 	            		</span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="NAME">Sarissa.getParseErrorText</span><span class="PUNC">(</span><span class="NAME">oDomDoc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>974</span> 	            	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>975</span> 	            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>976</span>         	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>977</span>         	</span><span class="KEYW">catch</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>978</span>         		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">callback</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>979</span>         			</span><span class="NAME">callback</span><span class="PUNC">(</span><span class="NAME">oForm</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">oTargetElement</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>980</span>         		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>981</span>         		</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>982</span>         			</span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>983</span>         		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>984</span>         	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>985</span>         </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>986</span>         </span><span class="NAME">xmlhttp.send</span><span class="PUNC">(</span><span class="NAME">bUseGet</span><span class="PUNC">?</span><span class="STRN">""</span><span class="PUNC">:</span><span class="NAME">params</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>987</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>988</span>     </span><span class="KEYW">catch</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>989</span>         </span><span class="NAME">Sarissa.updateCursor</span><span class="PUNC">(</span><span class="NAME">oTargetElement</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"auto"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>990</span>         </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">callback</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>991</span>         	</span><span class="NAME">callback</span><span class="PUNC">(</span><span class="NAME">oForm</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">oTargetElement</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>992</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>993</span>         </span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>994</span>         	</span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>995</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>996</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>997</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>998</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>999</span> 
<span class='line'>1000</span> </span><span class="COMM">/**
<span class='line'>1001</span>  * Get the name of a function created like:
<span class='line'>1002</span>  * &lt;pre>function functionName(){}&lt;/pre>
<span class='line'>1003</span>  * If a name is not found, attach the function to 
<span class='line'>1004</span>  * the window object with a new name and return that
<span class='line'>1005</span>  * @param {Function} oFunc the function object
<span class='line'>1006</span>  */</span><span class="WHIT">
<span class='line'>1007</span> </span><span class="NAME">Sarissa.getFunctionName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">oFunc</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1008</span> 	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">oFunc</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">oFunc</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">'function'</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1009</span> 		</span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="STRN">"The value of parameter 'oFunc' must be a function"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1010</span> 	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1011</span> 	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">oFunc.name</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> 
<span class='line'>1012</span> 		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">oFunc.name</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>1013</span> 	</span><span class="PUNC">}</span><span class="WHIT"> 
<span class='line'>1014</span> 	</span><span class="COMM">// try to parse the function name from the defintion </span><span class="WHIT">
<span class='line'>1015</span> 	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sFunc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">oFunc.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>1016</span> 	</span><span class="NAME">alert</span><span class="PUNC">(</span><span class="STRN">"sFunc: "</span><span class="PUNC">+</span><span class="NAME">sFunc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1017</span> 	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sFunc.substring</span><span class="PUNC">(</span><span class="NAME">sFunc.indexOf</span><span class="PUNC">(</span><span class="STRN">'function'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">8</span><span class="WHIT"> </span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sFunc.indexOf</span><span class="PUNC">(</span><span class="STRN">'('</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>1018</span> 	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">name.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">" "</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1019</span> 		</span><span class="COMM">// attach to window object under a new name</span><span class="WHIT">
<span class='line'>1020</span> 		</span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"SarissaAnonymous"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">Sarissa._getUniqueSuffix</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1021</span> 		</span><span class="NAME">window</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">oFunc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1022</span> 	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1023</span> 	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">name</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1024</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1025</span> 
<span class='line'>1026</span> </span><span class="COMM">/**
<span class='line'>1027</span>  *
<span class='line'>1028</span>  */</span><span class="WHIT">
<span class='line'>1029</span> </span><span class="NAME">Sarissa.setRemoteJsonCallback</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">url</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">callback</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">callbackParam</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1030</span> 	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">callbackParam</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1031</span> 		</span><span class="NAME">callbackParam</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"callback"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1032</span> 	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1033</span> 	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">callbackFunctionName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Sarissa.getFunctionName</span><span class="PUNC">(</span><span class="NAME">callback</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1034</span> 	</span><span class="COMM">//alert("callbackFunctionName: '" + callbackFunctionName+"', length: "+callbackFunctionName.length);</span><span class="WHIT">
<span class='line'>1035</span> 	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"sarissa_json_script_id_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">Sarissa._getUniqueSuffix</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>1036</span> 	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">oHead</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.getElementsByTagName</span><span class="PUNC">(</span><span class="STRN">"head"</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1037</span> 	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">scriptTag</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">'script'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1038</span> 	</span><span class="NAME">scriptTag.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'text/javascript'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1039</span> 	</span><span class="NAME">scriptTag.id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1040</span> 	</span><span class="NAME">scriptTag.onload</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1041</span> 		</span><span class="COMM">// cleanUp</span><span class="WHIT">
<span class='line'>1042</span> 		</span><span class="COMM">// document.removeChild(scriptTag);</span><span class="WHIT">
<span class='line'>1043</span> 	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1044</span> 	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">url.indexOf</span><span class="PUNC">(</span><span class="STRN">"?"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1045</span> 		</span><span class="NAME">url</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="STRN">"&"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">callbackParam</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"="</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">callbackFunctionName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1046</span> 	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1047</span> 	</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1048</span> 		</span><span class="NAME">url</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="STRN">"?"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">callbackParam</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"="</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">callbackFunctionName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1049</span> 	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1050</span> 	</span><span class="NAME">scriptTag.src</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">url</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1051</span>   	</span><span class="NAME">oHead.appendChild</span><span class="PUNC">(</span><span class="NAME">scriptTag</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1052</span>   	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1053</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1054</span> 
<span class='line'>1055</span> </span><span class="COMM">//   EOF</span><span class="WHIT">
<span class='line'>1056</span> </span></pre></body></html>